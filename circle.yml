machine:
  pre:
    - sudo apt-get update; USE_PRECOMPILE=true sudo -E circleci-install php 7.1.0

  php:
    version: 7.1.0

dependencies:
  override:
    - cp .env.testing .env
    - composer install --no-interaction
test:
  pre:
    - "./vendor/laravel/dusk/bin/chromedriver-linux":
        background: true
    - "php artisan serve":
        background: true

  override:
    - php artisan dusk

  post:
    - cp -r tests/Browser/console $CIRCLE_ARTIFACTS/console
    - cp -r tests/Browser/screenshots $CIRCLE_ARTIFACTS/screenshots
    - curl http://127.0.0.1:8000